"use strict";var vm=new Vue({el:"#addExpend",data:function(){var e=function(e,t,a){if(!t)return a(new Error("请输入支出金额"));/^\d{0,8}(\.\d{0,2})?$/.test(t)?a():a(new Error("请输入金额")),a()};return{keep:!0,actorName:"",drag:!0,disabled:!1,disabled1:!1,successIcon:!0,uploads:{img:!1,audio:!1,video:!1},file:[],accessory:!1,restaurants:[],names:[],disable:!1,newExpenseForm:{expenseType:"",expenseReason:"",totalAmount:"",expenseMemos:"",actorName:""},rules:{expenseType:[{required:!0,message:"请选择支出类型",trigger:"change"}],expenseReason:[{required:!0,validator:function(e,t,a){if(!t)return a(new Error("请输入支出事由"));a()},trigger:"blur"}],totalAmount:[{required:!0,validator:e,trigger:"blur"}],actorName:[{required:!0,message:"请选择下一步审批人",trigger:"change"}]},saveApprovalData:{},expend:[],expendPro:[{label:"提现"},{label:"购买配件"},{label:"购买设备"},{label:"其它"}]}},created:function(){this.fetchData()},mounted:function(){var e=this;this.$nextTick(function(){e.upload()})},methods:{fetchData:function(){var e=this;axios.get("/api/v1/funds/expenseform/loadBlank").then(function(t){null===t.data.data.processStateContext.nextActorId||""===t.data.data.processStateContext.nextActorId?e.newExpenseForm.actorName="":e.newExpenseForm.actorName=t.data.data.processStateContext.nextActorId,!1===t.data.data.processStateContext.todoer&&null!==t.data.data.processStateContext.nextActorId?e.disabled=!0:e.disabled=!1}).catch(function(e){console.log(e)}),axios.get("/api/v1/shop/employees").then(function(t){e.expend=t.data.data}).catch(function(e){console.log(e)})},saveApproval:function(e){var t=this,a=sessionStorage.getItem("nextActorId");t.saveApprovalData.expenseType=t.newExpenseForm.expenseType,t.saveApprovalData.expenseReason=t.newExpenseForm.expenseReason,t.saveApprovalData.expenseMemos=t.newExpenseForm.expenseMemos,t.saveApprovalData.totalAmount=100*t.newExpenseForm.totalAmount,t.$refs[e].validate(function(e){e&&axios({method:"post",url:"/api/v1/funds/expenseform/submit",data:t.saveApprovalData,params:{nextActorId:a}}).then(function(e){t.$message({message:"提交成功",type:"success"}),localStorage.setItem("file",JSON.stringify(t.file)),t.disable=!0,setTimeout(function(){window.location.href="/shop/expenseProcessForm"},3e3)}).catch(function(e){console.log(e)})})},upload:function(){var e=this;new Uploader({id:"btnImageUploader",mediaType:9,prefix:"dist",onComplete:function(t){document.getElementById("uploadImg");if(9===this.options.mediaType){var a=t.files[0];e.$message({type:"success",message:"上传成功"}),e.file.push(a)}}})},getNextActorId:function(){var e=this;sessionStorage&&sessionStorage.setItem("nextActorId",e.newExpenseForm.actorName)},delFile:function(e){this.file.splice(e,1)}}});