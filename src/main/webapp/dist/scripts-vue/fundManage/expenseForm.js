"use strict";function clone(t,e){var s=e||{};for(var i in t){var a=t[i];a!==s&&("object"===(void 0===a?"undefined":_typeof(a))?(s[i]=a.constructor===Array?[]:{},arguments.callee(a,s[i])):s[i]=a)}return s}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vm=new Vue({el:"#expenseForm",data:function(){return{expenseTitle:"",filterable:!0,agree:"",disagree:"",saveDialog:!1,selectArr:[],newProcessArr:[],listProcessArr:[],trueLabels:[],falseLabels:[],trueModel:[],falseModel:[],newLists:[],newList:{key:"",actors:"",functionIds:""},exData:{step:"",transactor:"",operation:"",del:""},transactorOption:[{userDto:{name:"不选择审批人",id:""}}],expenseFormData:[],expenseFormData1:[{step:"",transactor:"",operation:"",del:""}]}},created:function(){var t=sessionStorage.getItem("id");"-1"===t||""===t?this.newFetchData():this.listFetchData()},mounted:function(){var t=sessionStorage.getItem("id");"-1"===t||""===t?this.newData():this.listData()},methods:{listFetchData:function(){var t=this,e=sessionStorage.getItem("id");axios.get("/api/v1/workflow/definitions/"+e,{params:{entityId:e}}).then(function(e){for(var s in e.data.data.activityList){if(isNaN(parseInt(s)))return!1;t.expenseFormData.push(t.exData)}}).catch(function(t){console.log(t)})},newFetchData:function(){var t=this;t.expenseFormData=t.expenseFormData1;for(var e in t.expenseFormData){if(isNaN(parseInt(e)))return!1;t.selectArr.push({name:""}),t.trueLabels.push({trueLabel:""}),t.falseLabels.push({falseLabel:""}),t.trueModel.push({model:!1}),t.falseModel.push({model:!1})}},newData:function(){var t=this,e=sessionStorage.getItem("key");axios.get("/api/v1/workflow/definitions/loadBlank",{params:{pdTplKey:e}}).then(function(e){t.newProcessArr=e.data.data,t.expenseTitle=e.data.data.name,t.disagree=e.data.data.processDefinitionTpl.functions[0].name,t.agree=e.data.data.processDefinitionTpl.functions[1].name;for(var s in t.expenseFormData){if(isNaN(parseInt(s)))return!1;t.newProcessArr.activityList=t.newLists,t.newProcessArr.activityList.push(t.newList)}}).catch(function(t){console.log(t)}),axios.get("/api/v1/shop/employees").then(function(e){e.data.data.forEach(function(e,s,i){t.transactorOption.push(i[s])})}).catch(function(t){console.log(t)})},listData:function(){var t=this,e=sessionStorage.getItem("id");axios.get("/api/v1/workflow/definitions/"+e,{params:{entityId:e}}).then(function(e){t.listProcessArr=e.data.data,t.expenseTitle=e.data.data.name,t.disagree=e.data.data.processDefinitionTpl.functions[0].name,t.agree=e.data.data.processDefinitionTpl.functions[1].name,t.expenseFormData.forEach(function(e,s,i){t.selectArr.push({name:t.listProcessArr.activityList[s].actors}),t.listProcessArr.activityList[s].functionIds.indexOf("approval")>-1?(t.trueModel.push({model:!0}),t.trueLabels.push({trueLabel:"approval"})):(t.trueModel.push({model:!1}),t.trueLabels.push({trueLabel:""})),t.listProcessArr.activityList[s].functionIds.indexOf("reject")>-1?(t.falseModel.push({model:!0}),t.falseLabels.push({falseLabel:"reject"})):(t.falseModel.push({model:!1}),t.falseLabels.push({falseLabel:""}))})}).catch(function(t){console.log(t)}),axios.get("/api/v1/shop/employees").then(function(e){e.data.data.forEach(function(e,s,i){t.transactorOption.push(i[s])})}).catch(function(t){console.log(t)})},saveExpense:function(){var t=this,e=sessionStorage.getItem("id");axios({method:"post",url:"/api/v1/workflow/definitions/"+e,data:"-1"===e?t.newProcessArr:t.listProcessArr,params:{entityId:e}}).then(function(e){t.$message({message:"提交成功",type:"success"}),setTimeout(function(){window.location.href="/workflow/"},3e3)}).catch(function(t){console.log(t)})},addStep:function(){var t=this,e=t.expenseFormData[0],s={};clone(e,s),t.expenseFormData.push(s),t.selectArr.push({name:""}),t.trueLabels.push({trueLabel:""}),t.falseLabels.push({falseLabel:""}),t.trueModel.push({model:!1}),t.falseModel.push({model:!1}),t.newProcessArr!=={}&&0===t.listProcessArr.length&&(t.newProcessArr.activityList=t.newLists,t.newProcessArr.activityList.push(t.newList)),t.listProcessArr!=={}&&0===t.newProcessArr.length&&t.listProcessArr.activityList.push(t.newList)},deleteStep:function(t){var e=this;if(e.expenseFormData.length<=1)return e.saveDialog=!0,!1;e.expenseFormData[t]="",e.expenseFormData.splice(t,1),e.selectArr.splice(t,1),e.trueLabels.splice(t,1),e.falseLabels.splice(t,1),e.trueModel.splice(t,1),e.falseModel.splice(t,1),e.listProcessArr!=={}&&0===e.newProcessArr.length&&e.listProcessArr.activityList.splice(t,1),e.newProcessArr!=={}&&0===e.listProcessArr.length&&e.newProcessArr.activityList.splice(t,1)},trueChange:function(t){var e=this,s=e.trueModel,i=e.trueLabels,a=e.newProcessArr,n=e.listProcessArr;if(!0===s[t].model){if(i[t].trueLabel="approval",n!=={}&&0===a.length)if(""!==n.activityList[t].functionIds&&-1===n.activityList[t].functionIds.indexOf(i[t].trueLabel))n.activityList[t].functionIds=n.activityList[t].functionIds+","+i[t].trueLabel;else{if(""!==n.activityList[t].functionIds&&n.activityList[t].functionIds.indexOf(i[t].trueLabel)>-1)return!1;n.activityList[t].functionIds=i[t].trueLabel}if(a!=={}&&0===n.length)if(e.newProcessArr.activityList=e.newLists,""!==a.activityList[t].functionIds&&-1===a.activityList[t].functionIds.indexOf(i[t].trueLabel))a.activityList[t].functionIds=a.activityList[t].functionIds+","+i[t].trueLabel;else{if(""!==a.activityList[t].functionIds&&a.activityList[t].functionIds.indexOf(i[t].trueLabel)>-1)return!1;a.activityList[t].functionIds=i[t].trueLabel}}else a!=={}&&0===n.length&&(e.newProcessArr.activityList=e.newLists,a.activityList[t].functionIds=a.activityList[t].functionIds.replace(i[t].trueLabel,"").replace(",","")),n!=={}&&0===a.length&&(n.activityList[t].functionIds=n.activityList[t].functionIds.replace(i[t].trueLabel,"").replace(",",""))},falseChange:function(t){var e=this,s=e.falseModel,i=e.falseLabels,a=e.newProcessArr,n=e.listProcessArr;if(!0===s[t].model){if(i[t].falseLabel="reject",n!=={}&&0===a.length)if(""!==n.activityList[t].functionIds&&-1===n.activityList[t].functionIds.indexOf(i[t].falseLabel))n.activityList[t].functionIds=e.listProcessArr.activityList[t].functionIds+","+i[t].falseLabel;else{if(""!==n.activityList[t].functionIds&&n.activityList[t].functionIds.indexOf(i[t].falseLabel)>-1)return!1;e.listProcessArr.activityList[t].functionIds=e.falseLabels[t].falseLabel}if(a!=={}&&0===n.length)if(e.newProcessArr.activityList=e.newLists,""!==a.activityList[t].functionIds&&-1===a.activityList[t].functionIds.indexOf(i[t].falseLabel))a.activityList[t].functionIds=a.activityList[t].functionIds+","+i[t].trueLabel;else{if(""!==a.activityList[t].functionIds&&a.activityList[t].functionIds.indexOf(i[t].falseLabel)>-1)return!1;a.activityList[t].functionIds=i[t].falseLabel}}else a!=={}&&0===n.length&&(e.newProcessArr.activityList=e.newLists,a.activityList[t].functionIds=a.activityList[t].functionIds.replace(i[t].falseLabel,"").replace(",","")),n!=={}&&0===a.length&&(n.activityList[t].functionIds=n.activityList[t].functionIds.replace(i[t].falseLabel,"").replace(",",""))},selectActor:function(t){var e=this;e.listProcessArr!=={}&&0===e.newProcessArr.length&&(e.listProcessArr.activityList[t].actors=e.selectArr[t].name),e.newProcessArr!=={}&&0===e.listProcessArr.length&&(e.newProcessArr.activityList.push(e.newList),e.newProcessArr.activityList[t].actors=e.selectArr[t].name)}}});