"use strict";var vm=new Vue({el:"#fundManage",data:function(){return{addExpendsDia:!1,modalBody:!0,modal:!0,activeName:"交易记录",type:"",dateSelect:[],getDay:"",expenseTit:"",sortable:!0,createdArr:[],created:"",defaultSort:{prop:"accountingDate",order:"descending"},pageArray:{total:0,size:10,current:parseInt(sessionStorage.getItem("fundSize")),lastPage:"",firstPage:""},appPageArray:{total:0,size:10,current:parseInt(sessionStorage.getItem("appCurrent")),lastPage:"",firstPage:""},fundManageSearch:"",dateOption:{shortcuts:[{text:"最近一周",onClick:function(a){var e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),a.$emit("pick",[t,e])}},{text:"最近一月",onClick:function(a){var e=new Date,t=new Date;t.setTime(t.getTime()-2592e6),a.$emit("pick",[t,e])}}]},fundManage:[{text:"已收用户押金",money:"",style:"greenBox",iconClass:"icon-img_x"},{text:"近7日收入",money:"",style:"yellowBox",iconClass:"icon-img_x1"},{text:"近7日支出",money:"",style:"CambridgeBlueBox",iconClass:"icon-icon_expense"},{text:"可用余额",money:"",style:"purpleBox",iconClass:"icon-yue"},{text:"资金池余额",money:"",style:"blueBox",iconClass:"icon-zijin"}],fundManageTab:[{label:"交易记录",name:"交易记录"},{label:"待审批支出",name:"待审批支出"}],fundManageType:[{name:"押金",value:"deposit"},{name:"收入",value:"income"},{name:"支出",value:"expense"},{name:"租金",value:"rental"},{name:"所有类型",value:""}],dataTit:[{pro:"select",width:"50",label:"",type:"selection"},{pro:"type",width:"100",label:"交易类型",type:""},{pro:"accountingDate",width:"150",label:"交易时间",type:""},{pro:"summary",width:"450",label:"交易摘要",type:"",fit:!1},{pro:"amount",width:"",label:"交易金额",type:""},{pro:"customerName",width:"",label:"经办人",type:""}],approvalTit:[{pro:"expenseType",width:"",label:"支出类型",type:""},{pro:"expenseReason",width:"450",label:"支出事由",type:""},{pro:"totalAmount",width:"",label:"支出金额",type:""},{pro:"creator",width:"",label:"申请人",type:""},{pro:"created",width:"",label:"申请时间",type:""},{pro:"toders",width:"",label:"当前处理人",type:""}],fundManageData:[],approvalData:[]}},created:function(){this.fetchData()},methods:{fetchData:function(){var a=this;null!==sessionStorage.getItem("appCurrent")?a.appPageArray.current=parseInt(sessionStorage.getItem("appCurrent")):a.appPageArray.current=1,null!==sessionStorage.getItem("fundSize")?a.pageArray.current=parseInt(sessionStorage.getItem("fundSize")):a.pageArray.current=1,a.type=sessionStorage.getItem("fundType"),a.dateSelect=[sessionStorage.getItem("fundStartDate"),sessionStorage.getItem("fundEndDate")],a.fundManageSearch=sessionStorage.getItem("fundSearch"),null!==sessionStorage.getItem("tabName")?a.activeName=sessionStorage.getItem("tabName"):a.activeName="交易记录",axios.get("/api/v1/funds/dashboard").then(function(e){a.fundManage[0].money=e.data.data.totalDeposit/100,a.fundManage[1].money=e.data.data.incomeFor7d/100,a.fundManage[2].money=e.data.data.expenseFor7d/100,a.fundManage[3].money=e.data.data.availableBalance/100,a.fundManage[4].money=e.data.data.totalIncome/100}).catch(function(a){console.log(a)}),axios.get("/api/v1/funds/account/details",{params:{current:a.pageArray.current,rowCount:a.pageArray.size,"sort[accountingDate]":"desc",type:a.type,startDate:""===a.dateSelect[0]?"":sessionStorage.getItem("fundStartDate"),endDate:""===a.dateSelect[1]?"":sessionStorage.getItem("fundEndDate"),searchPhrase:a.fundManageSearch}}).then(function(e){a.fundManageData=e.data.data.fileList,a.pageArray.total=e.data.data.totalElements,a.fundManageData.length<a.pageArray.size?0===a.fundManageData.length?(a.pageArray.fisrtPage=0,a.pageArray.lastPage=0):(a.pageArray.fisrtPage=a.pageArray.total-a.fundManageData.length+1,a.pageArray.lastPage=a.pageArray.total):a.fundManageData.length===a.pageArray.size&&(a.pageArray.fisrtPage=a.pageArray.current*a.fundManageData.length-(a.pageArray.size-1),a.pageArray.lastPage=a.pageArray.current*a.fundManageData.length),a.fundManageData.forEach(function(a,t,r){var n=new Date(r[t].accountingDate);switch(r[t].accountingDate=n.Format("yyyy-MM-dd"),r[t].amount=(r[t].amount/100).toFixed(2),"expense"===r[t].type?r[t].customerName=e.data.data.fileList[t].operator:r[t].customerName=e.data.data.fileList[t].customerName,r[t].type){case"deposit":r[t].type="押金";break;case"income":r[t].type="收入";break;case"expense":r[t].type="支出";break;case"rental":r[t].type="租金"}})}).catch(function(a){console.log(a)}),axios("/api/v1/funds/expenseform",{params:{current:a.appPageArray.current,rowCount:a.appPageArray.size,"sort[created]":"desc",viewType:"processing"}}).then(function(e){a.approvalData=e.data.data.fileList,a.appPageArray.total=e.data.data.totalElements,a.approvalData.length<a.appPageArray.size?(a.appPageArray.fisrtPage=a.appPageArray.total-a.approvalData.length+1,a.appPageArray.lastPage=a.appPageArray.total):a.approvalData.length===a.appPageArray.size&&(a.appPageArray.fisrtPage=a.appPageArray.current*a.approvalData.length-(a.appPageArray.size-1),a.appPageArray.lastPage=a.appPageArray.current*a.approvalData.length),e.data.data.fileList.forEach(function(a,e,t){var r=new Date(t[e].created);t[e].created=r.Format("yyyy-MM-dd"),t[e].totalAmount=(t[e].totalAmount/100).toFixed(2)})}).catch(function(a){console.log(a)})},currentChange:function(a){var e=this;e.pageArray.current=a,sessionStorage.setItem("fundSize",a),axios.get("/api/v1/funds/account/details",{params:{current:e.pageArray.current,rowCount:e.pageArray.size,"sort[accountingDate]":"desc",type:e.type,startDate:""===e.dateSelect[0]?"":new Date(e.dateSelect[0]).Format("yyyy-MM-dd"),endDate:""===e.dateSelect[1]?"":new Date(e.dateSelect[1]).Format("yyyy-MM-dd"),searchPhrase:e.fundManageSearch}}).then(function(a){e.fundManageData=a.data.data.fileList,e.pageArray.total=a.data.data.totalElements,e.fundManageData.length<e.pageArray.size?0===e.fundManageData.length?(e.pageArray.fisrtPage=0,e.pageArray.lastPage=0):(e.pageArray.fisrtPage=e.pageArray.total-e.fundManageData.length+1,e.pageArray.lastPage=e.pageArray.total):e.fundManageData.length===e.pageArray.size&&(e.pageArray.fisrtPage=e.pageArray.current*e.fundManageData.length-(e.pageArray.size-1),e.pageArray.lastPage=e.pageArray.current*e.fundManageData.length),e.fundManageData.forEach(function(e,t,r){var n=new Date(r[t].accountingDate);switch(r[t].accountingDate=n.Format("yyyy-MM-dd"),r[t].amount=(r[t].amount/100).toFixed(2),"expense"===r[t].type?r[t].customerName=a.data.data.fileList[t].operator:r[t].customerName=a.data.data.fileList[t].customerName,r[t].type){case"deposit":r[t].type="押金";break;case"income":r[t].type="收入";break;case"expense":r[t].type="支出";break;case"rental":r[t].type="租金"}})}).catch(function(a){console.log(a)})},sizeChange:function(a){var e=this;e.pageArray.size=a,axios.get("/api/v1/funds/account/details",{params:{current:e.pageArray.current,rowCount:e.pageArray.size,"sort[accountingDate]":"desc",type:e.type,startDate:""===e.dateSelect[0]?"":new Date(e.dateSelect[0]).Format("yyyy-MM-dd"),endDate:""===e.dateSelect[1]?"":new Date(e.dateSelect[1]).Format("yyyy-MM-dd"),searchPhrase:e.fundManageSearch}}).then(function(a){e.pageArray.current=sessionStorage.getItem("fundSize"),e.fundManageData=a.data.data.fileList,e.pageArray.total=a.data.data.totalElements,e.fundManageData.length<e.pageArray.size?0===e.fundManageData.length?(e.pageArray.fisrtPage=0,e.pageArray.lastPage=0):(e.pageArray.fisrtPage=e.pageArray.total-e.fundManageData.length+1,e.pageArray.lastPage=e.pageArray.total):e.fundManageData.length===e.pageArray.size&&(e.pageArray.fisrtPage=e.pageArray.current*e.fundManageData.length-(e.pageArray.size-1),e.pageArray.lastPage=e.pageArray.current*e.fundManageData.length),e.fundManageData.forEach(function(e,t,r){var n=new Date(r[t].accountingDate);switch(r[t].accountingDate=n.Format("yyyy-MM-dd"),r[t].amount=(r[t].amount/100).toFixed(2),"expense"===r[t].type?r[t].customerName=a.data.data.fileList[t].operator:r[t].customerName=a.data.data.fileList[t].customerName,r[t].type){case"deposit":r[t].type="押金";break;case"income":r[t].type="收入";break;case"expense":r[t].type="支出";break;case"rental":r[t].type="租金"}})}).catch(function(a){console.log(a)})},appCurrentChange:function(a){var e=this;e.appPageArray.current=a,sessionStorage.setItem("appCurrent",a),axios("/api/v1/funds/expenseform",{params:{current:e.appPageArray.current,rowCount:e.appPageArray.size,"sort[created]":"desc",viewType:"processing"}}).then(function(a){e.approvalData=a.data.data.fileList,e.appPageArray.total=a.data.data.totalElements,e.approvalData.length<e.appPageArray.size?(e.appPageArray.fisrtPage=e.appPageArray.total-e.approvalData.length+1,e.appPageArray.lastPage=e.appPageArray.total):e.approvalData.length===e.appPageArray.size&&(e.appPageArray.fisrtPage=e.appPageArray.current*e.approvalData.length-(e.appPageArray.size-1),e.appPageArray.lastPage=e.appPageArray.current*e.approvalData.length),a.data.data.fileList.forEach(function(a,e,t){var r=new Date(t[e].created);t[e].created=r.Format("yyyy-MM-dd"),t[e].totalAmount=(t[e].totalAmount/100).toFixed(2)})}).catch(function(a){console.log(a)})},appSizeChange:function(a){var e=this;e.appPageArray.size=a,axios("/api/v1/funds/expenseform",{params:{current:e.appPageArray.current,rowCount:e.appPageArray.size,"sort[created]":"desc",viewType:"processing"}}).then(function(a){e.approvalData=a.data.data.fileList,e.appPageArray.total=a.data.data.totalElements,e.approvalData.length<e.appPageArray.size?(e.appPageArray.fisrtPage=e.appPageArray.total-e.approvalData.length+1,e.appPageArray.lastPage=e.appPageArray.total):e.approvalData.length===e.appPageArray.size&&(e.appPageArray.fisrtPage=e.appPageArray.current*e.approvalData.length-(e.appPageArray.size-1),e.appPageArray.lastPage=e.appPageArray.current*e.approvalData.length),a.data.data.fileList.forEach(function(a,e,t){var r=new Date(t[e].created);t[e].created=r.Format("yyyy-MM-dd"),t[e].totalAmount=(t[e].totalAmount/100).toFixed(2)})}).catch(function(a){console.log(a)})},searchValue:function(){var a=this;sessionStorage.setItem("fundType",a.type),sessionStorage.setItem("fundStartDate",a.dateSelect[0]),sessionStorage.setItem("fundEndDate",a.dateSelect[1]),sessionStorage.setItem("fundSearch",a.fundManageSearch),axios.get("/api/v1/funds/account/details",{params:{current:a.pageArray.current,rowCount:a.pageArray.size,"sort[accountingDate]":"desc",type:a.type,startDate:""===a.dateSelect[0]?"":new Date(a.dateSelect[0]).Format("yyyy-MM-dd"),endDate:""===a.dateSelect[1]?"":new Date(a.dateSelect[1]).Format("yyyy-MM-dd"),searchPhrase:a.fundManageSearch}}).then(function(e){a.fundManageData=e.data.data.fileList,a.pageArray.total=e.data.data.totalElements,a.fundManageData.length<a.pageArray.size?0===a.fundManageData.length?(a.pageArray.fisrtPage=0,a.pageArray.lastPage=0):(a.pageArray.fisrtPage=a.pageArray.total-a.fundManageData.length+1,a.pageArray.lastPage=a.pageArray.total):a.fundManageData.length===a.pageArray.size&&(a.pageArray.fisrtPage=a.pageArray.current*a.fundManageData.length-(a.pageArray.size-1),a.pageArray.lastPage=a.pageArray.current*a.fundManageData.length),a.fundManageData.forEach(function(a,t,r){var n=new Date(r[t].accountingDate);switch(r[t].accountingDate=n.Format("yyyy-MM-dd"),r[t].amount=(r[t].amount/100).toFixed(2),"expense"===r[t].type?r[t].customerName=e.data.data.fileList[t].operator:r[t].customerName=e.data.data.fileList[t].customerName,r[t].type){case"deposit":r[t].type="押金";break;case"income":r[t].type="收入";break;case"expense":r[t].type="支出";break;case"rental":r[t].type="租金"}})}).catch(function(a){console.log(a)})},getID:function(a){sessionStorage&&sessionStorage.setItem("expenseId",a.id),window.location.href="/shop/expenseProcessForm/"+a.id},addExpends:function(){var a=this;axios.get("/api/v1/workflow/definitions").then(function(e){e.data.data.forEach(function(e,t,r){if("-1"===r[t].id)return a.addExpendsDia=!0,!1;window.location.href="/shop/expenseProcessForm/addExpend"})}).catch(function(a){console.log(a)})},gotoWorkflow:function(){window.location.href="/workflow"},detail:function(a){var e=this;if(e.fundManageData[a].formUrl.indexOf("/lease/rechargeOrder/")>-1){var t=e.fundManageData[a].formUrl.replace("/lease/rechargeOrder/","");sessionStorage.setItem("rechargeId",t)}if(e.fundManageData[a].formUrl.indexOf("/shop/expenseProcessForm/")>-1){var r=e.fundManageData[a].formUrl.replace("/shop/expenseProcessForm/","");sessionStorage.setItem("expenseId",r)}setTimeout(function(){window.location.href=e.fundManageData[a].formUrl},300)},fundFresh:function(){sessionStorage.setItem("fundType",""),sessionStorage.setItem("fundStartDate",""),sessionStorage.setItem("fundEndDate",""),sessionStorage.setItem("fundSearch",""),sessionStorage.setItem("fundSize",1),sessionStorage.setItem("appCurrent",1),sessionStorage.setItem("tabName","交易记录")},fundClick:function(a){sessionStorage.setItem("tabName",a.name)}}});