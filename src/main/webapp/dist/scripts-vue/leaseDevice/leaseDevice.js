"use strict";new Vue({el:"#equip",data:function(){return{activeName:"支出明细",city:"所有地区",sorts:"custom",searchText:"搜索",isIcon:!1,operateBtn:!0,equipSearches:{product:"",equipSearch:""},typeSearch:{type:"",vals:""},pageArray:{total:0,current:1,size:10,fisrtPage:0,lastPage:0},equip:[{style:"blueBox",name:"已租设备",text:"0",val:"all"},{style:"grayBox",name:"离线",text:"0",val:"offline"},{style:"redBox",name:"异常",text:"0",val:"error"},{style:"yellowBox",name:"即将到期",text:"0",val:"soon"},{style:"blackBox",name:"逾期",text:"0",val:"overdue"}],equipTab:[{label:"支出明细",name:"支出明细"},{label:"待审批支出",name:"待审批支出"},{label:"服务商提现申请",name:"服务商提现申请"}],equipType:[{name:"所有状态",value:"all"},{name:"在线",value:"online"},{name:"离线",value:"offline"},{name:"异常",value:"error"},{name:"即将到期",value:"soon"},{name:"已逾期",value:"overdue"}],equipProduct:[{name:"所有产品",value:""}],equipCity:[{text:"北京"},{text:"广州"}],dataTit:[{pro:"online",label:"状态",width:"100"},{pro:"leaseProductName",width:"",label:"产品名称",type:""},{pro:"lessee",width:"150",label:"客户名称",type:""},{pro:"address.fullAddress",width:"",label:"安装地址",type:""},{pro:"leaseStartDate",width:"120",label:"起租日期",type:""},{pro:"leaseDueDate",width:"120",label:"到期日期",type:""}],equipData:[],returnEquipData:[]}},created:function(){var e=this;this.fetchData(),this.$nextTick(function(){screen.width<1199&&e.tableTit()})},methods:{fetchData:function(){var e=this;null!==sessionStorage.getItem("devicePage")?e.pageArray.current=parseInt(sessionStorage.getItem("devicePage")):e.pageArray.current=1,e.typeSearch.vals=sessionStorage.getItem("deviceType"),e.equipSearches.product=sessionStorage.getItem("deviceProduct"),e.equipSearches.equipSearch=sessionStorage.getItem("deviceSearch"),axios.get("/api/v1/lease/devices/dashboard").then(function(a){e.equip[0].text=a.data.data.totalDeviceCount,e.equip[1].text=a.data.data.offlineDeviceCount,e.equip[2].text=a.data.data.errorDeviceCount,e.equip[3].text=a.data.data.dueSoonDeviceCount,e.equip[4].text=a.data.data.overdueDeviceCount}),axios.get("/api/v1/lease/devices",{params:{current:e.pageArray.current,rowCount:e.pageArray.size,viewType:e.typeSearch.vals,leaseProductId:e.equipSearches.product,searchPhrase:e.equipSearches.equipSearch,"sort[purchasedDate]":"desc"}}).then(function(a){if("Error"===a.data.data)e.$message.error(a.data.errMsg);else{e.pageArray.total=a.data.data.totalElements,e.equipData=a.data.data.fileList,e.equipData.forEach(function(e,a,t){!1===t[a].iotDevice.online?t[a].online="离线":t[a].online="在线"}),e.equipData.length<e.pageArray.size?0===e.equipData.length?(e.pageArray.fisrtPage=0,e.pageArray.lastPage=0):(e.pageArray.fisrtPage=e.pageArray.total-e.equipData.length+1,e.pageArray.lastPage=e.pageArray.total):e.equipData.length===e.pageArray.size&&(e.pageArray.fisrtPage=e.pageArray.current*e.equipData.length-(e.pageArray.size-1),e.pageArray.lastPage=e.pageArray.current*e.equipData.length);for(var t in e.equipData){var r=new Date(e.equipData[t].leaseStartDate),i=new Date(e.equipData[t].leaseDueDate);""===e.equipData[t].leaseStartDate&&""===e.equipData[t].leaseDueDate||(e.equipData[t].leaseStartDate=r.Format("yyyy-MM-dd"),e.equipData[t].leaseDueDate=i.Format("yyyy-MM-dd"))}}}).catch(function(e){console.log(e)}),axios.get("/api/v1/lease/products/listOptions").then(function(a){var t=a.data.data.unique();for(var r in t){if(isNaN(parseInt(r)))return!1;e.equipProduct.push(t[r])}}).catch(function(e){console.log(e)}),screen.width<1200?(this.searchText="",this.isIcon=!0,this.operateBtn=!1):(this.searchText="搜索",this.isIcon=!1,this.operateBtn=!0)},handleSizeChange:function(e){var a=this;a.pageArray.size=e,axios.get("/api/v1/lease/devices",{params:{current:a.pageArray.current,rowCount:a.pageArray.size,viewType:a.typeSearch.vals,leaseProductId:a.equipSearches.product,searchPhrase:a.equipSearches.equipSearch,"sort[purchasedDate]":"desc"}}).then(function(e){if("Error"===e.data.data)a.$message.error(e.data.errMsg);else{a.pageArray.total=e.data.data.totalElements,a.equipData=e.data.data.fileList,a.equipData.forEach(function(e,a,t){!1===t[a].iotDevice.online?t[a].online="离线":t[a].online="在线"}),a.equipData.length<a.pageArray.size?0===a.equipData.length?(a.pageArray.fisrtPage=0,a.pageArray.lastPage=0):(a.pageArray.fisrtPage=a.pageArray.total-a.equipData.length+1,a.pageArray.lastPage=a.pageArray.total):a.equipData.length===a.pageArray.size&&(a.pageArray.fisrtPage=a.pageArray.current*a.equipData.length-(a.pageArray.size-1),a.pageArray.lastPage=a.pageArray.current*a.equipData.length);for(var t in a.equipData){var r=new Date(a.equipData[t].leaseStartDate),i=new Date(a.equipData[t].leaseDueDate);""===a.equipData[t].leaseStartDate&&""===a.equipData[t].leaseDueDate||(a.equipData[t].leaseStartDate=r.Format("yyyy-MM-dd"),a.equipData[t].leaseDueDate=i.Format("yyyy-MM-dd"))}}}).catch(function(e){console.log(e)})},handleCurrentChange:function(e){var a=this;a.pageArray.current=e,sessionStorage.setItem("devicePage",e),axios.get("/api/v1/lease/devices",{params:{current:a.pageArray.current,rowCount:a.pageArray.size,viewType:a.typeSearch.vals,leaseProductId:a.equipSearches.product,searchPhrase:a.equipSearches.equipSearch,"sort[purchasedDate]":"desc"}}).then(function(e){if("Error"===e.data.data)a.$message.error(e.data.errMsg);else{a.pageArray.total=e.data.data.totalElements,a.equipData=e.data.data.fileList,a.equipData.forEach(function(e,a,t){!1===t[a].iotDevice.online?t[a].online="离线":t[a].online="在线"}),a.equipData.length<a.pageArray.size?0===a.equipData.length?(a.pageArray.fisrtPage=0,a.pageArray.lastPage=0):(a.pageArray.fisrtPage=a.pageArray.total-a.equipData.length+1,a.pageArray.lastPage=a.pageArray.total):a.equipData.length===a.pageArray.size&&(a.pageArray.fisrtPage=a.pageArray.current*a.equipData.length-(a.pageArray.size-1),a.pageArray.lastPage=a.pageArray.current*a.equipData.length);for(var t in a.equipData){var r=new Date(a.equipData[t].leaseStartDate),i=new Date(a.equipData[t].leaseDueDate);""===a.equipData[t].leaseStartDate&&""===a.equipData[t].leaseDueDate||(a.equipData[t].leaseStartDate=r.Format("yyyy-MM-dd"),a.equipData[t].leaseDueDate=i.Format("yyyy-MM-dd"))}}}).catch(function(e){console.log(e)})},getValue:function(e){if(sessionStorage){sessionStorage.setItem("value",this.equip[e].val);var a=sessionStorage.getItem("value");this.typeSearch.vals=a}},gainID:function(e){console.log(e),sessionStorage.setItem("id",e.id),sessionStorage.setItem("leaseProductId",e.leaseProductId),sessionStorage.setItem("productId",e.productId),sessionStorage.setItem("deviceId",e.deviceId),window.location.href="/lease/devices/"+e.id},sortChange:function(e){console.log(e)},searchChange:function(){var e=this;sessionStorage.setItem("deviceType",e.typeSearch.vals),sessionStorage.setItem("deviceProduct",e.equipSearches.product),sessionStorage.setItem("deviceSearch",e.equipSearches.equipSearch),axios.get("/api/v1/lease/devices",{params:{current:e.pageArray.current,rowCount:e.pageArray.size,viewType:e.typeSearch.vals,leaseProductId:e.equipSearches.product,searchPhrase:e.equipSearches.equipSearch,"sort[purchasedDate]":"desc"}}).then(function(a){if("Error"===a.data.data)e.$message.error(a.data.errMsg);else{if(e.pageArray.total=a.data.data.totalElements,e.equipData=a.data.data.fileList,e.equipData.forEach(function(e,a,t){!1===t[a].iotDevice.online?t[a].online="离线":t[a].online="在线"}),e.equipData.length<e.pageArray.size?0===e.equipData.length?(e.pageArray.fisrtPage=0,e.pageArray.lastPage=0):(e.pageArray.fisrtPage=e.pageArray.total-e.equipData.length+1,e.pageArray.lastPage=e.pageArray.total):e.equipData.length===e.pageArray.size&&(e.pageArray.fisrtPage=e.pageArray.current*e.equipData.length-(e.pageArray.size-1),e.pageArray.lastPage=e.pageArray.current*e.equipData.length),"all"===e.equipSearches.product)return e.equipData;for(var t in e.equipData){var r=new Date(e.equipData[t].leaseStartDate),i=new Date(e.equipData[t].leaseDueDate);""===e.equipData[t].leaseStartDate&&""===e.equipData[t].leaseDueDate||(e.equipData[t].leaseStartDate=r.Format("yyyy-MM-dd"),e.equipData[t].leaseDueDate=i.Format("yyyy-MM-dd"))}}}).catch(function(e){console.log(e)})},rowClass:function(e,a){return new Date>new Date(e.leaseDueDate)?"overdue equipRecords":"equipRecords"},deviceFresh:function(){sessionStorage.setItem("devicePage",1),sessionStorage.setItem("deviceType",""),sessionStorage.setItem("deviceProduct",""),sessionStorage.setItem("deviceSearch","")},tableTit:function(){}}});