var Spage=function(t){var a={id:"spage",url:"",params:{},startPage:0,pageSize:12,onLoaded:null},e=function(e){this.options=t.extend({},a,e),this.options.element?this.$element=t(this.options.element):this.$element=t("#"+this.options.id),this.$body=null,this.$toolbar=null,this.loading=!1,this.pageRequest={page:0,size:this.options.pageSize||12},this.pagination={totalPages:0,totalElements:0,isLast:0,pageNumber:0},this._init(),this.fetch()};return e.prototype={constructor:e,fetch:function(){var a=this.options.url;if(""===a)return void t.error("Spage must be setting this option: url");var e=this;e.loading=!0,t.ajax({url:a,data:t.extend({},e.pageRequest,e.options.params),dataType:"html",type:"GET"}).done(function(t){e.$body.html(t),e._renderPagination(),"function"==typeof e.options.onLoaded&&e.options.onLoaded.call(e)}).fail(function(a){t.error("fail to fetch data"+JSON.stringify(a))}).always(function(){e.loading=!1})},curPage:function(){var t=this.pagination.pageNumber;return 0===this.options.startPage&&t--,t},next:function(){this.pagination.isLast||(this.pageRequest.page++,this.fetch())},prev:function(){this.pagination.pageNumber!==this.options.startPage&&(this.pageRequest.page--,this.fetch())},goPage:function(){var t=this,a=t.$toolbar.find("#spagePageNumber").val();if(""!==a&&null!==a){if((a=parseInt(a))>t.pagination.totalPages||a<t.options.startPage)return void toast("请输入正确的页数","error");0===t.options.startPage&&(a--,a<0&&(a=0),t.pageRequest.page=a),t.fetch()}},refresh:function(a){this.options.params=t.extend({},this.options.params,"object"==typeof a?a:{}),this.pageRequest.page=this.options.startPage,this.fetch()},_init:function(){this.$element.append(t('<div class="spage-body"/>')).append(t('<div class="spage-toolbar"/>')),this.$body=this.$element.find(".spage-body"),this.$toolbar=this.$element.find(".spage-toolbar");var a="<button class='btn btn-default btn-prev'><span class='spage-prev'></span></button>";a+="<div class='inline valign-middle'><span id='spageCurPage'>0</span>/<span id='spageTotalPages'>0</span></div>",a+="<button class='btn btn-default btn-next'><span class='spage-next'></span></button>",a+="<input type='number' class='form-control' id='spagePageNumber'/>",a+="<button class='btn btn-default btn-gopage'>跳转</button>",this.$toolbar.append(a);var e=this;e.$toolbar.find(".btn-prev").off("click").on("click",function(){e.prev()}),e.$toolbar.find(".btn-next").off("click").on("click",function(){e.next()}),e.$toolbar.find(".btn-gopage").off("click").on("click",function(){e.goPage()})},_renderPagination:function(){var t=this,a=t.$body.find(".spage-data");t.pagination={totalPages:parseInt(a.data("totalpages")),totalElements:parseInt(a.data("totalelements")),pageNumber:parseInt(a.data("pagenumber")),isLast:"true"===a.data("islast")||!0===a.data("islast")};var e=t.pagination.pageNumber;0===t.options.startPage&&e++,t.$toolbar.find("#spageCurPage").text(e),t.$toolbar.find("#spageTotalPages").text(t.pagination.totalPages),t.$toolbar.find("#spageTotalEelemets").text(t.pagination.totalElements),0===t.pagination.totalPages?t.$toolbar.hide():(t.$toolbar.show(),0===t.pagination.pageNumber?t.$toolbar.find(".btn-prev").hide():t.$toolbar.find(".btn-prev").show(),t.pagination.isLast?t.$toolbar.find(".btn-next").hide():t.$toolbar.find(".btn-next").show())}},e}(jQuery);!function(t){function a(a){return this.each(function(){var e=t(this),n=e.data("bs.spage"),o=t.extend({element:this},e.data(),"object"==typeof a&&a);n||e.data("bs.spage",n=new Spage(o)),"string"==typeof a&&(n[a]?n[a]():t.error("Method "+a+" does not exist on jQuery.spage"))})}t.fn.spage=a,t.fn.spage.Constructor=Spage}(jQuery);