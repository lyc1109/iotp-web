var ImagePicker=function(){var e={id:"btnImagePicker",title:"选择图片",width:900,height:530,multiple:!1,onOk:null},t=function(t,i){this.options={},this.$element=null,this.dlg=null,"object"==typeof t?(this.options=$.extend({},e,t),this.$element=$("#"+this.options.id)):(this.$element=$("#"+t),i&&(this.options=$.extend({},this.options,i))),this.imageSpage=null,this.groupId=null,this._init()};return t.prototype={getImages:function(){var e=[],t=this.dlg.$smodal.find(".images-item.checked");return 0===t.length?e:(t.each(function(){e.push({id:$(this).data("id"),name:$(this).data("name"),url:$(this).data("url"),fileSize:$(this).data("filesize")})}),e)},_init:function(){var e=this.options,t=this;this.dlg=new Dlg({element:this.$element[0],url:"/media/images/picker?multiple="+e.multiple,title:e.title,width:e.width,height:e.height,buttons:[{id:"btnCancel",class:"btn-default",text:"取消"},{id:"btnOk",class:"btn-primary",text:"确定"},{id:"btnImageUploader",class:"btn-success pull-left",text:"上传图片"}],onOk:function(){var e=t.getImages();if(0===e.length)return Messenger.error("请选择图片"),!1;t.options.onOk.call(t,e),this.close()},onLoaded:function(){t._onLoaded(),new Uploader({id:"btnImageUploader",multi:!0,managable:!0,prefix:$("#mediaGroupPrefix").val(),saveGroup:function(){var e="",t=$(".group-item.active");return t.length>0&&"全部图片"!==t.data("name")&&(e=t.data("name")),e},onComplete:function(){var e=t.dlg;$.get(e.options.url,e.options.data,function(i){e.$smodal.find(".body").html(i),t._onLoaded()})}})}})},_onLoaded:function(){var e=this,t=this.dlg,i=t.$smodal,n=!0===i.find("#multiple").val()||"true"===i.find("#multiple").val();e.imageSpage=new Spage({id:i.attr("id")+" #imagesSpage",url:"/media/images/page4picker",onLoaded:function(){i.find(".images-item").off("click").on("click",function(){n?$(this).toggleClass("checked"):(i.find(".images-item.checked").removeClass("checked"),$(this).addClass("checked"))}),i.find(".group-item").off("click").on("click",function(){$(".images-picker").find(".group-item").removeClass("active"),$(this).addClass("active"),e.groupId=$(this).data("id"),e.imageSpage.refresh({groupId:e.groupId})})}})}},t}();