var MediaImg=function(e,t,i,n,a){var o=null,c={init:function(){this._initSpage(),this._initUploader(),this._initMediaGroup(),this._initMediaActions()},addGroup:function(){i.propup({message:"新建分组",inputPlaceholder:"请输入分组名称"},function(e){if(""===e.trim())return void toast("请输入分组名称","error");t.ajax.post({url:"/media/group/create",data:{group:e},onSuccess:function(e){window.location.reload()}})})},editGroup:function(e,n){i.propup({message:"编辑分组",inputPlaceholder:"请输入分组名称",inputValue:n},function(i){if(""===i.trim())return void toast("请输入分组名称","error");t.ajax.patch({url:"/media/group/"+e,data:{group:i},onSuccess:function(){window.location.reload()}})})},deleteGroup:function(e,i){window.swal({title:"是否确定删除分组:"+i+"?",type:"question",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(n){!0===n&&window.swal({title:"是否同时删除分组 ["+i+"] 中所有的图片?",type:"question",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(i){!0===i&&t.ajax.del({url:"/media/group/media/"+e,onSuccess:function(){window.location.reload()}})},function(i){"cancel"===i&&t.ajax.del({url:"/media/group/"+e,onSuccess:function(){window.location.reload()}})})})},updateCount:function(t,i,n){var a=e(".group-item[data-id='"+t+"']"),o=e(".group-item[data-name='全部图片']"),c=a.data("mediaCount"),d=o.data("mediaCount");null===t||"全部分类"===i?(o.find(".text-second").text("("+(d+n)+")"),o.data("mediaCount",d+n)):(a.find(".text-second").text("("+(c+n)+")"),a.data("mediaCount",c+n),o.find(".text-second").text("("+(d+n)+")"),o.data("mediaCount",d+n))},_initSpage:function(){o=new n({id:"spage4images",url:"/media/images/page",pageSize:18,onLoaded:function(){e(".media-img").on("click",function(){e(this).siblings(".check").find(".media-icheck").iCheck("toggle")}),e(".media-icheck").on("ifChecked",function(t){e(this).closest(".images-item").addClass("active"),c._toggleActions()}),e(".media-icheck").on("ifUnchecked",function(t){e(this).closest(".images-item").removeClass("active"),c._toggleActions()}),e(".media-icheck").iCheck({checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue"})}})},_initUploader:function(){var t=0;new a({id:"btnImageUploader",multi:!0,managable:!0,startOnAdd:!1,prefix:e("#mediaGroupPrefix").val(),saveGroup:function(){var t="",i=e(".group-item.active");return i.length>0&&"全部图片"!==i.data("name")&&(t=i.data("name")),t},onAdd:function(e,i){t=i.length,e.start()},onComplete:function(){var i=e(".group-item.active").data("id"),n=e(".group-item.active").data("name");c.updateCount(i,n,t),o.refresh()}})},_initMediaGroup:function(){var t=this;e("#btnAddGroup").on("click",function(){t.addGroup()}),e(".group-edit").on("click",function(){t.editGroup(e(this).data("id"),e(this).data("name"))}),e(".group-delete").on("click",function(){t.deleteGroup(e(this).data("id"),e(this).data("name"))}),e(".group-name").on("click",function(){e(".group-name").closest("li").removeClass("active"),e(this).closest("li").addClass("active"),e("#groupName").text(e(this).data("name")),o.refresh({groupId:e(this).data("id")})})},_initMediaActions:function(){e("#checkAll").on("ifChecked",function(){e(".images-item").addClass("active"),e(".images-item").find(".media-icheck").iCheck("check"),c._toggleActions()}),e("#checkAll").on("ifUnchecked",function(){e(".images-item").removeClass("active"),e(".images-item").find(".media-icheck").iCheck("uncheck"),c._toggleActions()}),e("#btnMediaDelete").on("click",function(){var n=c._getCheckedItemIds();if(null===n)return void toast("请选择需要处理的素材","error");i.confirm("是否确定删除素材？",function(){t.ajax.post({url:"/media/delete",data:{mediaIds:n},onSuccess:function(){o.refresh();var t=e(".group-item.active").data("id"),i=e(".group-item.active").data("name");c.updateCount(t,i,0-n.split(",").length)}})})})},_toggleActions:function(){e(".images-item.active").length>0?e("#mediaActions").is(":hidden")&&e("#mediaActions").fadeIn():e("#mediaActions").fadeOut()},_getCheckedItemIds:function(){if(0===e(".images-item.active").length)return null;var t=[];return e.each(e(".images-item.active"),function(){t.push(e(this).data("id"))}),t.join(",")}};return c}(jQuery,App,Messenger,Spage,Uploader);