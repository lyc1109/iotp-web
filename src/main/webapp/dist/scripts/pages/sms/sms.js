var Sms=function(e,t){var s=function(t,s,n){this.$element=e(t),this.$molie=e(s),this.checkUser=n||!1,this.sec=60,this.interval=0,this.canSend=!1,this._onKeyupForMobile(),this._onClickForSmsCode()};return s.prototype={sendValidCode:function(){var e=this;t.ajax.post({url:"/sys/sms/validcode",data:{mobile:e.$molie.val(),checkUser:e.checkUser},onSuccess:function(t){var s="";t.code&&(s="验证码："+t.code),toast("短信发送成功，请注意查收。"+s),e.toggleAction(!1),e.secCountDown(),e.$element.trigger("sms.sendSuccess")}})},checkValidCode:function(e,s){var n=this;t.ajax.post({url:"/sys/sms/validcode/check",data:{mobile:n.$molie.val(),code:e},onSuccess:function(e){e.isMatch?s.call(this):toast("验证码输入不正确","error")}})},toggleAction:function(e){60!==this.sec&&0!==this.interval||(e?(this.$element.prop("disabled",!1).addClass("btn-success"),this.canSend=!0):(this.$element.prop("disabled",!0).removeClass("btn-success"),this.canSend=!1))},secCountDown:function(){var e=this;e.interval=setInterval(function(){e.sec--,e.$element.text(e.sec+"s"),0===e.sec&&(clearInterval(e.interval),e.sec=60,e.interval=0,e.$element.text("重新获取"),e.toggleAction(!0))},1e3)},reset:function(){clearInterval(this.interval),this.sec=60,this.interval=0,this.$element.text("重新获取"),this.toggleAction(!0)},_onKeyupForMobile:function(){var t=this,s=/^1[3|4|5|7|8][0-9]{9}$/;t.$molie.attr("data-parsley-pattern",s),t.$molie.on("keyup blur",function(){var n=e(this).val();s.test(n)?t.toggleAction(!0):t.toggleAction(!1)})},_onClickForSmsCode:function(){var e=this;e.$element.off("click").on("click",function(){e.canSend&&e.sendValidCode()})}},s}(jQuery,App);